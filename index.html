<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Nursing Prometric Test – Full Android Engine</title>
<style>
body{
  font-family: Arial;
  background:#eef5f5;
  margin:0;
  padding:0;
  overflow-x:hidden;
}
.landing{
  text-align:center;
  padding:20px;
}
.button{
  display:inline-block;
  padding:15px 25px;
  margin:10px;
  background:#007b83;
  color:white;
  border-radius:8px;
  text-decoration:none;
  cursor:pointer;
  font-size:18px;
}
#quizRoot{
  display:none;
  padding:15px;
}
#timerBox{
  font-size:22px;
  margin-bottom:10px;
}
#progressBox{
  font-size:20px;
  margin-bottom:10px;
}
#subtitleBox{
  font-size:20px;
  margin-bottom:10px;
  color:#005f63;
}
#rationaleBox{
  margin-top:20px;
  font-size:20px;
  padding:15px;
  background:#ffffff;
  border-left:5px solid #007b83;
  border-radius:10px;
}{
  display:none;
  padding:15px;
}
#questionBox{
  background:white;
  padding:20px;
  border-radius:12px;
  font-size:24px;
  margin-bottom:20px;
  min-height:120px;
}
.option{
  background:white;
  padding:18px;
  border-radius:12px;
  margin-bottom:15px;
  font-size:22px;
  border:2px solid #007b83;
}
</style>
<audio id="sndCorrect" src="https://www.soundjay.com/button/sounds/button-4.mp3" preload="auto"></audio>
<audio id="sndWrong" src="https://www.soundjay.com/button/sounds/button-10.mp3" preload="auto"></audio>
<audio id="sndNext" src="https://www.soundjay.com/button/sounds/button-30.mp3" preload="auto"></audio>
</head>
<body>
<div class="landing">
  <h1>Welcome to Nursing Prometric Simulation Test</h1>
  <p>Full 500-item Android-Compatible Test</p>
  <button class="button" onclick="startUnlockFlow()">Start Full Test</button>
</div>

<div id="dashboard"></div>

<div id="quizRoot">
  <div id="timerBox"></div>
  <div id="progressBox"></div>
  <div id="subtitleBox"></div>
  <div id="questionBox">Loading...</div>
  <div id="optionsBox"></div>
  <button class="button" onclick="prevQ()">⬅ Previous</button>
  <button class="button" onclick="nextQ()">Next ➡</button>
  <div id="rationaleBox"></div>
</div>

<script>
const BACKEND_URL = "https://script.google.com/macros/s/AKfycbyAahjib1U3F-L1HrRDItXBKImZXZNORT7z7hyKz373wq5Xg-xGParOZlO8J4B7hjXT/exec";
let questions=[];
let currentIndex=0;
let user=null;

function el(id){return document.getElementById(id);} 

function startUnlockFlow(){
  el('dashboard').innerHTML = `
    <h2>Enter Special Unlock Code</h2>
    <input id="unlockInput" placeholder="Enter Code" style="font-size:20px;padding:10px;width:80%"><br><br>
    <button class="button" onclick="submitUnlock()">Unlock Test</button>
  `;
}

async function submitUnlock(){
  const code = el('unlockInput').value.trim();
  if(!code){alert('Please enter code');return}
  user = { userId:"android_user" };
  const payload = { action:'verifyCode', userId:user.userId, code: code };
  try{
    const res = await fetch(BACKEND_URL, {
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
    });
    const j = await res.json();
    if(j.ok){ alert('✅ Code verified! Starting full test...'); loadQuestionsAndStart(); }
    else alert('Invalid code');
  }catch(e){ alert('Network error'); }
}

async function loadQuestionsAndStart(){
  document.querySelector('.landing').style.display='none';
  el('dashboard').innerHTML='';
  el('quizRoot').style.display='block';
  el('questionBox').innerText = 'Loading questions...';
  try{
    const res = await fetch(BACKEND_URL + '?getQuestions=1');
    const data = await res.json();
    questions = data;
    currentIndex = 0;
    renderQuestion();
  }catch(e){ el('questionBox').innerText='Failed to load questions'; }
}

function renderQuestion(){
  const q = questions[currentIndex];
  el('questionBox').innerText = q.no + '. ' + q.question;
  const box = el('optionsBox');
  box.innerHTML = '';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className='option';
    div.innerText = opt;
    div.onclick = ()=>checkAnswer(i);
    box.appendChild(div);
  });
}

function checkAnswer(i){
  currentIndex++;
  if(currentIndex>=questions.length){ el('questionBox').innerText='✅ Test Completed'; el('optionsBox').innerHTML=''; return; }
  renderQuestion();
}
</script>
<script>
// ✅ Full upgrade: sounds, timer, rationale, progress, next/back, subtitle

let timer=0, timerInterval=null;

function startTimer(){
  timer=0;
  timerInterval = setInterval(()=>{
    timer++;
    el('timerBox').innerText = '⏳ ' + timer + 's';
  },1000);
}

function stopTimer(){ clearInterval(timerInterval); }

function renderQuestion(){
  const q = questions[currentIndex];

  el('questionBox').innerHTML = `<strong>${q.no}. ${q.question}</strong>`;
  el('subtitleBox').innerText = q.subtitle || '';

  const box = el('optionsBox');
  box.innerHTML = '';

  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className='option';
    div.innerText = opt;
    div.onclick = ()=>checkAnswer(i,q.correct,q.rationale);
    box.appendChild(div);
  });

  el('progressBox').innerText = `${q.no} / ${questions.length}`;
}

function checkAnswer(selected,correct,rationale){
  if(selected===correct){ alert('✅ Correct'); }
  else { alert('❌ Incorrect'); }

  el('rationaleBox').innerText = rationale || '';
}

function nextQ(){
  if(currentIndex < questions.length-1){ currentIndex++; renderQuestion(); }
  else { finishTest(); }
}

function prevQ(){
  if(currentIndex>0){ currentIndex--; renderQuestion(); }
}

function finishTest(){
  stopTimer();
  el('questionBox').innerText = '✅ Test Completed';
  el('optionsBox').innerHTML='';
  el('rationaleBox').innerText='Great job!';
}
</script>
</body>
</html>
