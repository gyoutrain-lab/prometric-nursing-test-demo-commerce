<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    <h3>Generate Unlock Codes</h3>
    <p>Select a user:</p>
    <select id="userSelect"></select><br><br>
    <button onclick="generateCode()">Generate Code</button>
    <p id="result"></p>

    <script>
      // Populate user dropdown
      google.script.run.withSuccessHandler(function(users){
        const select = document.getElementById('userSelect');
        users.forEach(u=>{
          const opt = document.createElement('option');
          opt.value = u.userId;
          opt.text = u.name + " (@"+u.telegram+")";
          select.add(opt);
        });
      }).getAllUsers();

      function generateCode(){
        const userId = document.getElementById('userSelect').value;
        google.script.run.withSuccessHandler(function(res){
          document.getElementById('result').innerText = 'Unlock code: ' + res.code;
        }).generateUnlockCodeForAdmin(userId);
      }
    </script>
  </body>
</html>
